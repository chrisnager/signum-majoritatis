<!doctype html>
<html>
  <head>
    <title>Signum majoritatis</title>
    <style>html {font: bold 10em \}</style>
  </head>
  <body>
    <pre></pre>
    <script>
      var sequence = ' READY GO!'
      var obstacles = '^-_'
      var score = -sequence.length
      var refreshObstacleInterval

      var KeyPressHandler = {
        down(event) {
          if (event.keyCode === 38) {
            Player.jump()
          } else if (event.keyCode === 40) {
            Player.duck()
          }
        },

        up() {
           Player.stand()
        }
      }

      var Player = {
        jump: function() {
          sequence = '\'' + sequence.substr(1)
          Game.render()
        },

        stand: function() {
          sequence = '>' + sequence.substr(1)
          Game.render()
        },

        duck: function() {
          sequence = ',' + sequence.substr(1)
          Game.render()
        },

        explode: function() {
          sequence = '* SCORE: ' + score
          Game.render()
        }
      }

      var Game = {
        checkCollision: function(nearestObstacle) {
          if (
            (nearestObstacle === obstacles[0] && sequence[0] === '\'')
            || (nearestObstacle === obstacles[1] && sequence[0] === '>')
            || (nearestObstacle === obstacles[2] && sequence[0] === ',')
          ) {
            Player.explode()
            clearInterval(refreshObstacleInterval)
            Game.render()
          }
        },

        setNewObstacle: function() {
          score++
          Game.increaseSpeed()
          Game.checkCollision(sequence[1])
          sequence = sequence [0] + sequence.substr(2) + obstacles[~~(Math.random() * 3)]
          Game.render()
        },

        increaseSpeed: function() {
          clearInterval(refreshObstacleInterval)
          refreshObstacleInterval = setInterval(Game.setNewObstacle, 500 - score * 2.5)
        },

        render: function() {
          document.getElementsByTagName('pre')[0].textContent = sequence
        },

        initialize: function() {
          window.addEventListener('keydown', KeyPressHandler.down, true)
          window.addEventListener('keyup', KeyPressHandler.up, true)
          refreshObstacleInterval = setInterval(Game.setNewObstacle, 500)
          Player.stand()
        }
      }

      Game.initialize()
    </script>
  </body>
</html>